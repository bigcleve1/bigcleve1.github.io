<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>526给王</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #050505; 
            user-select: none; 
            touch-action: none; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
        }
        canvas { display: block; }

        /* iOS 风格排行榜样式 */
        #leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 220px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 16px;
            color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }

        .lb-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lb-title::after {
            content: "LIVE";
            font-size: 10px;
            background: #ff3b30;
            padding: 2px 6px;
            border-radius: 4px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        #rank-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rank-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            animation: slideIn 0.4s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .rank-name {
            font-weight: 400;
            color: rgba(255, 255, 255, 0.9);
        }

        .rank-level {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            color: #fff;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="leaderboard">
        <div class="lb-title">排行榜</div>
        <div id="rank-list"></div>
    </div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { alpha: false });
    const rankListElement = document.getElementById('rank-list');

    let texts = [];
    let particles = [];
    let shakeTime = 0;
    let bgOverlay = 0;

    [span_3](start_span)const names = ["董佳琦", "翟利杰", "李子奥", "王浩瑞", "杜英达", "燕奕轩", "徐浩伦", "温祖国", "尚淼晨", "冯天乐", "谷禹龙", "田星", "王烨阳", "庞逸桐", "王晨骁"];[span_3](end_span)

    function resize() {
        [span_4](start_span)canvas.width = window.innerWidth;[span_4](end_span)
        [span_5](start_span)canvas.height = window.innerHeight;[span_5](end_span)
    }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor(x, y, hue, forceScale = 1) {
            [span_6](start_span)this.x = x;[span_6](end_span)
            [span_7](start_span)this.y = y;[span_7](end_span)
            this.hue = hue;
            [span_8](start_span)this.size = Math.random() * 4 + 2;[span_8](end_span)
            [span_9](start_span)const angle = Math.random() * Math.PI * 2;[span_9](end_span)
            [span_10](start_span)const force = (Math.random() * 6 + 4) * forceScale;[span_10](end_span)
            [span_11](start_span)this.vx = Math.cos(angle) * force;[span_11](end_span)
            [span_12](start_span)this.vy = Math.sin(angle) * force;[span_12](end_span)
            this.life = 1.0;
            [span_13](start_span)this.decay = Math.random() * 0.02 + 0.015;[span_13](end_span)
            [span_14](start_span)this.gravity = 0.15;[span_14](end_span)
        }
        update() {
            [span_15](start_span)this.vx *= 0.96;[span_15](end_span)
            [span_16](start_span)this.vy *= 0.96;[span_16](end_span)
            [span_17](start_span)this.vy += this.gravity;[span_17](end_span)
            [span_18](start_span)this.x += this.vx;[span_18](end_span)
            [span_19](start_span)this.y += this.vy;[span_19](end_span)
            [span_20](start_span)this.life -= this.decay;[span_20](end_span)
        }
        draw() {
            [span_21](start_span)if (this.life <= 0) return;[span_21](end_span)
            [span_22](start_span)ctx.fillStyle = `hsla(${this.hue}, 100%, 70%, ${this.life})`;[span_22](end_span)
            ctx.beginPath();
            [span_23](start_span)ctx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);[span_23](end_span)
            ctx.fill();
        }
    }

    class FlyingText {
        constructor(x, y, name, level = 1) {
            [span_24](start_span)this.x = x;[span_24](end_span)
            [span_25](start_span)this.y = y;[span_25](end_span)
            this.name = name;
            [span_26](start_span)this.content = name + "是给";[span_26](end_span)
            [span_27](start_span)this.level = level;[span_27](end_span)
            [span_28](start_span)this.vx = (Math.random() - 0.5) * (8 + level * 2);[span_28](end_span)
            [span_29](start_span)this.vy = (Math.random() - 0.5) * (8 + level * 2);[span_29](end_span)
            [span_30](start_span)this.hue = Math.random() * 360;[span_30](end_span)
            [span_31](start_span)this.baseSize = (Math.random() * 5 + 20) + (this.level - 1) * 15;[span_31](end_span)
            [span_32](start_span)this.scale = 2.5;[span_32](end_span)
            this.toRemove = false;
            [span_33](start_span)this.updateMetrics();[span_33](end_span)
        }

        updateMetrics() {
            [span_34](start_span)ctx.font = `bold ${this.baseSize}px "Microsoft YaHei"`;[span_34](end_span)
            [span_35](start_span)this.width = ctx.measureText(this.content).width;[span_35](end_span)
        }

        update() {
            [span_36](start_span)this.x += this.vx;[span_36](end_span)
            [span_37](start_span)this.y += this.vy;[span_37](end_span)
            [span_38](start_span)if (this.scale > 1) this.scale -= 0.15;[span_38](end_span)
            if (this.x <= 0) { this.vx *= -1; this.x = 0; this.onHit(); [span_39](start_span)}
            if (this.x >= canvas.width - this.width) { this.vx *= -1; this.x = canvas.width - this.width; this.onHit(); }[span_39](end_span)
            if (this.y <= this.baseSize) { this.vy *= -1; this.y = this.baseSize; this.onHit(); [span_40](start_span)}
            if (this.y >= canvas.height) { this.vy *= -1; this.y = canvas.height; this.onHit(); }[span_40](end_span)
            [span_41](start_span)this.hue = (this.hue + 1) % 360;[span_41](end_span)
        }

        onHit() {
            [span_42](start_span)shakeTime = 3;[span_42](end_span)
            for (let i = 0; i < 3; i++) {
                [span_43](start_span)particles.push(new Particle(this.x + this.width/2, this.y - this.baseSize/2, this.hue));[span_43](end_span)
            }
        }

        draw() {
            [span_44](start_span)ctx.save();[span_44](end_span)
            [span_45](start_span)ctx.translate(this.x, this.y);[span_45](end_span)
            [span_46](start_span)ctx.scale(this.scale, this.scale);[span_46](end_span)
            [span_47](start_span)const color = `hsl(${this.hue}, 100%, 75%)`;[span_47](end_span)
            [span_48](start_span)ctx.font = `bold ${this.baseSize}px "Microsoft YaHei"`;[span_48](end_span)
            [span_49](start_span)ctx.shadowBlur = 10 + this.level * 5;[span_49](end_span)
            [span_50](start_span)ctx.shadowColor = color;[span_50](end_span)
            [span_51](start_span)ctx.fillStyle = color;[span_51](end_span)
            [span_52](start_span)ctx.fillText(this.content, 0, 0);[span_52](end_span)
            [span_53](start_span)ctx.restore();[span_53](end_span)
        }
    }

    // 排行榜更新逻辑
    function updateLeaderboardUI() {
        const stats = {};
        texts.forEach(t => {
            if (!stats[t.name] || t.level > stats[t.name]) {
                stats[t.name] = t.level;
            }
        });

        const sorted = Object.entries(stats)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 6);

        const html = sorted.map(([name, level]) => `
            <div class="rank-item">
                <span class="rank-name">${name}</span>
                <span class="rank-level">LV.${level}</span>
            </div>
        `).join('');

        if (rankListElement.innerHTML !== html) {
            rankListElement.innerHTML = html;
        }
    }

    function handleAction(e) {
        [span_54](start_span)if(e.type === 'touchstart') e.preventDefault();[span_54](end_span)
        const x = e.clientX || (e.touches && e.touches[0].clientX)[span_55](start_span);
        const y = e.clientY || (e.touches && e.touches[0].clientY);[span_55](end_span)
        [span_56](start_span)if (!x || !y) return;[span_56](end_span)

        [span_57](start_span)const name = names[Math.floor(Math.random() * names.length)];[span_57](end_span)
        [span_58](start_span)texts.push(new FlyingText(x, y, name));[span_58](end_span)
        [span_59](start_span)for(let i=0; i<12; i++) particles.push(new Particle(x, y, Math.random()*360));[span_59](end_span)
        [span_60](start_span)shakeTime = 6;[span_60](end_span)
        [span_61](start_span)bgOverlay = 0.1;[span_61](end_span)
    }

    [span_62](start_span)window.addEventListener('mousedown', handleAction);[span_62](end_span)
    [span_63](start_span)window.addEventListener('touchstart', handleAction, { passive: false });[span_63](end_span)

    function checkSynthesis() {
        for (let i = 0; i < texts.length; i++) {
            for (let j = i + 1; j < texts.length; j++) {
                [span_64](start_span)let t1 = texts[i];[span_64](end_span)
                [span_65](start_span)let t2 = texts[j];[span_65](end_span)
                if (!t1.toRemove && !t2.toRemove && t1.name === t2.name) {
                    [span_66](start_span)const dx = (t1.x + t1.width / 2) - (t2.x + t2.width / 2);[span_66](end_span)
                    [span_67](start_span)const dy = (t1.y - t1.baseSize / 2) - (t2.y - t2.baseSize / 2);[span_67](end_span)
                    [span_68](start_span)const distance = Math.sqrt(dx * dx + dy * dy);[span_68](end_span)
                    [span_69](start_span)if (distance < (t1.width + t2.width) / 3) {[span_69](end_span)
                        [span_70](start_span)t1.toRemove = true;[span_70](end_span)
                        [span_71](start_span)t2.toRemove = true;[span_71](end_span)
                        [span_72](start_span)const centerX = (t1.x + t2.x) / 2;[span_72](end_span)
                        [span_73](start_span)const centerY = (t1.y + t2.y) / 2;[span_73](end_span)
                        [span_74](start_span)const nextLevel = Math.max(t1.level, t2.level) + 1;[span_74](end_span)
                        setTimeout(() => {
                            [span_75](start_span)texts.push(new FlyingText(centerX, centerY, t1.name, nextLevel));[span_75](end_span)
                        }, 10);
                        [span_76](start_span)createSynthesisEffect(centerX, centerY, t1.hue);[span_76](end_span)
                    }
                }
            }
        }
        [span_77](start_span)texts = texts.filter(t => !t.toRemove);[span_77](end_span)
    }

    function createSynthesisEffect(x, y, hue) {
        [span_78](start_span)shakeTime = 15;[span_78](end_span)
        [span_79](start_span)bgOverlay = 0.4;[span_79](end_span)
        for (let i = 0; i < 40; i++) {
            [span_80](start_span)particles.push(new Particle(x, y, hue, 2));[span_80](end_span)
            [span_81](start_span)particles.push(new Particle(x, y, (hue + 180) % 360, 1.5));[span_81](end_span)
        }
    }

    function animate() {
        [span_82](start_span)ctx.save();[span_82](end_span)
        if (shakeTime > 0) {
            [span_83](start_span)ctx.translate((Math.random()-0.5)*shakeTime, (Math.random()-0.5)*shakeTime);[span_83](end_span)
            [span_84](start_span)shakeTime--;[span_84](end_span)
        }
        [span_85](start_span)ctx.fillStyle = '#050505';[span_85](end_span)
        [span_86](start_span)ctx.fillRect(0, 0, canvas.width, canvas.height);[span_86](end_span)
        [span_87](start_span)ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';[span_87](end_span)
        [span_88](start_span)ctx.fillRect(0, 0, canvas.width, canvas.height);[span_88](end_span)

        if (bgOverlay > 0) {
            [span_89](start_span)ctx.fillStyle = `rgba(255, 255, 255, ${bgOverlay})`;[span_89](end_span)
            [span_90](start_span)ctx.fillRect(0, 0, canvas.width, canvas.height);[span_90](end_span)
            [span_91](start_span)bgOverlay -= 0.02;[span_91](end_span)
        }

        [span_92](start_span)checkSynthesis();[span_92](end_span)
        [span_93](start_span)particles = particles.filter(p => p.life > 0);[span_93](end_span)
        [span_94](start_span)particles.forEach(p => { p.update(); p.draw(); });[span_94](end_span)
        [span_95](start_span)texts.forEach(t => { t.update(); t.draw(); });[span_95](end_span)
        
        // 实时更新排行榜
        updateLeaderboardUI();

        [span_96](start_span)ctx.restore();[span_96](end_span)
        [span_97](start_span)requestAnimationFrame(animate);[span_97](end_span)
    }

    animate();
</script>
</body>
</html>
